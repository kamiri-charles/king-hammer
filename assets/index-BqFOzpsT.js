var w=Object.defineProperty;var k=(e,i,t)=>i in e?w(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var s=(e,i,t)=>k(e,typeof i!="symbol"?i+"":i,t);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const h={GAME_WIDTH:1024,GAME_HEIGHT:576,BLOCK_SIZE:32,GRAVITY:1,JUMP_HEIGHT:10,MAX_JUMPS:1},v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,27,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,28,0,0,0,0,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0,0,42,361,0,0,357,358,359,357,358,359,357,358,359,357,358,359,0,0,0,0,0,0,0,0,0,0,0,40,0,0,0,0,42,361,361,0,0,0,0,0,0,0,0,0,0,0,0,357,358,359,0,0,0,0,0,0,0,0,0,40,0,0,0,0,42,361,361,361,0,0,0,0,0,0,0,0,0,0,0,0,0,357,358,359,0,0,0,0,0,0,0,40,0,0,0,0,42,361,361,361,361,0,0,0,0,0,0,0,0,0,0,0,0,0,0,357,358,359,0,0,0,0,0,40,0,0,0,0,42,361,357,358,359,357,358,359,357,358,359,357,358,359,361,0,0,0,0,0,285,357,358,359,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,0,0,0,0,0,0,357,358,359,0,0,0,304,285,285,0,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,361,361,323,304,304,0,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,0,0,361,0,0,0,0,0,0,357,358,359,285,323,323,0,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,0,361,361,0,0,0,0,0,357,358,359,361,304,361,361,0,0,0,0,40,0,0,0,0,42,0,0,0,0,0,0,0,361,361,361,0,0,0,0,357,358,359,361,361,323,361,361,0,0,0,0,40,0,0,0,0,46,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,47,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],E=[{height:16,type:"box",x:95,y:481},{height:16,type:"box",x:116.5,y:481.5},{height:16,type:"box",x:107,y:466.5},{height:16,type:"box",x:137.5,y:480.5},{height:16,type:"box",x:130.5,y:465.5},{height:16,type:"box",x:118,y:450.5},{height:16,type:"box",x:522.666666666667,y:480.666666666667},{height:16,type:"box",x:501.666666666667,y:481},{height:16,type:"box",x:684,y:352.25},{height:16,type:"box",x:662.75,y:352.5},{height:16,type:"box",x:674.5,y:336.75},{height:16,type:"box",x:799.666666666667,y:481},{height:16,type:"box",x:821.333333333333,y:481.333333333333},{height:16,type:"box",x:803,y:465},{height:16,type:"box",x:825.333333333333,y:464.333333333333},{height:16,type:"box",x:815.666666666667,y:448.333333333333},{height:16,type:"box",x:842.666666666667,y:481},{height:56,type:"door",x:879.666666666667,y:481.666666666667}],p={1:{collision_blocks:v,objects_data:E,player_position:{x:200,y:400}}},j=(e=[])=>{const i=[];for(let t=0;t<e.length;t+=h.GAME_WIDTH/h.BLOCK_SIZE)i.push(e.slice(t,t+h.GAME_WIDTH/h.BLOCK_SIZE));return i};class I{constructor({position:i={x:0,y:0},collision_blocks:t=[]}={}){s(this,"position");s(this,"shrapnel");s(this,"shrapnel_count");s(this,"collision_blocks");s(this,"marked_for_deletion");this.position=i,this.shrapnel_count=10,this.collision_blocks=t,this.shrapnel=[],this.marked_for_deletion=!1,this.init()}init(){for(let i=0;i<this.shrapnel_count;i++){let t=Math.floor(Math.random()*4+1);this.shrapnel.push(new M({position:{x:this.position.x,y:this.position.y},image_src:`assets/spritesheets/box/BoxPieces${t}.png`,collision_blocks:this.collision_blocks}))}}update(){this.shrapnel=this.shrapnel.filter(i=>!i.marked_for_deletion),this.shrapnel.length===0&&(this.marked_for_deletion=!0)}render(i){this.update(),this.shrapnel.forEach(t=>t.render(i))}}class M{constructor({position:i={x:0,y:0},image_src:t="assets/spritesheets/box/BoxPieces1.png",collision_blocks:o=[]}={}){s(this,"image_src");s(this,"shrapnel_img");s(this,"position");s(this,"velocity");s(this,"rotation");s(this,"rotation_speed");s(this,"opacity");s(this,"fade_rate");s(this,"collision_blocks");s(this,"marked_for_deletion");this.position=i,this.image_src=t,this.shrapnel_img=new Image,this.shrapnel_img.src=t,this.velocity=this.randomVelocity(),this.rotation=Math.random()*360,this.rotation_speed=(Math.random()-.5)*10,this.opacity=1,this.fade_rate=.01,this.collision_blocks=o,this.marked_for_deletion=!1}randomVelocity(){const i=Math.random()*5+2,t=(Math.random()-1)*Math.PI;return{x:i*Math.cos(t),y:i*Math.sin(t)*.5}}update(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.y+=.1,this.rotation+=this.rotation_speed,this.opacity-=this.fade_rate,this.opacity<0&&(this.opacity=0),this.collision_blocks.forEach(i=>{const t=this.getCollisionSide(i);t&&((t==="left"||t==="right")&&(this.velocity.x=0),t==="top"&&(this.velocity.y=0,this.rotation_speed=0),t==="bottom"&&(this.velocity.y=0))}),this.opacity<=0&&(this.marked_for_deletion=!0)}getCollisionSide(i){const t=this.position.x+this.shrapnel_img.width/2,o=this.position.x-this.shrapnel_img.width/2,n=this.position.y-this.shrapnel_img.height/2,a=this.position.y+this.shrapnel_img.height/2,r=i.position.x+i.width,c=i.position.x,f=i.position.y,_=i.position.y+i.height;if(t>c&&o<r&&a>f&&n<_){const d=t-c,y=r-o,g=a-f,x=_-n,l=Math.min(d,y,g,x);if(l===d)return"left";if(l===y)return"right";if(l===g)return"top";if(l===x)return"bottom"}return null}render(i){this.update(),i.save(),i.globalAlpha=this.opacity,i.translate(this.position.x,this.position.y),i.rotate(this.rotation*Math.PI/180),i.drawImage(this.shrapnel_img,-this.shrapnel_img.width/2,-this.shrapnel_img.height/2),i.restore()}}class G{constructor({position:i={x:0,y:0}}={}){s(this,"position");s(this,"width");s(this,"height");this.position=i,this.width=h.BLOCK_SIZE,this.height=h.BLOCK_SIZE}draw(i,{fill:t="transparent",outline:o="transparent"}={}){i.fillStyle=t,i.strokeStyle=o,i.fillRect(this.position.x,this.position.y,this.width,this.height),i.strokeRect(this.position.x,this.position.y,this.width,this.height)}render(i,{fill:t="transparent",outline:o="transparent"}={}){this.draw(i,{fill:t,outline:o})}}class m{constructor({position:i={x:0,y:0},image_src:t="",type:o=""}={}){s(this,"position");s(this,"image_src");s(this,"obj_image");s(this,"type");s(this,"width");s(this,"height");s(this,"marked_for_deletion");this.position=i,this.image_src=t,this.obj_image=new Image,this.obj_image.src=this.image_src,this.type=o,this.width=this.obj_image.width,this.height=this.obj_image.height,this.marked_for_deletion=!1}draw(i){i.drawImage(this.obj_image,this.position.x,this.position.y)}render(i){this.draw(i)}}class L extends m{constructor({position:t={x:0,y:0},type:o="door"}={}){super({position:t,image_src:"assets/spritesheets/door/Idle.png",type:o});s(this,"position");this.position=t}}class H extends m{constructor({position:t={x:0,y:0},type:o="box"}={}){super({position:t,image_src:"assets/spritesheets/box/Idle.png",type:o});s(this,"position");s(this,"hp");this.position=t,this.hp=10}}const u={idle_right:{image_src:"assets/spritesheets/player/IdleRight.png",frame_rate:11,frame_buffer:2,loop:!0},idle_left:{image_src:"assets/spritesheets/player/IdleLeft.png",frame_rate:11,frame_buffer:2,loop:!0},run_right:{image_src:"assets/spritesheets/player/RunRight.png",frame_rate:8,frame_buffer:2,loop:!0},run_left:{image_src:"assets/spritesheets/player/RunLeft.png",frame_rate:8,frame_buffer:2,loop:!0},jump_right:{image_src:"assets/spritesheets/player/JumpRight.png",frame_rate:1,frame_buffer:2,loop:!0},jump_left:{image_src:"assets/spritesheets/player/JumpLeft.png",frame_rate:1,frame_buffer:2,loop:!0},fall_right:{image_src:"assets/spritesheets/player/FallRight.png",frame_rate:1,frame_buffer:2,loop:!0},fall_left:{image_src:"assets/spritesheets/player/FallLeft.png",frame_rate:1,frame_buffer:2,loop:!0},attack_right:{image_src:"assets/spritesheets/player/AttackRight.png",frame_rate:3,frame_buffer:3,loop:!1},attack_left:{image_src:"assets/spritesheets/player/AttackLeft.png",frame_rate:3,frame_buffer:3,loop:!1},enter_door:{image_src:"assets/spritesheets/player/EnterDoor.png",frame_rate:8,frame_buffer:4,loop:!1}};class b{constructor({position:i={x:0,y:0},width:t=58,height:o=58,image_src:n=""}={}){s(this,"position");s(this,"width");s(this,"height");s(this,"image_src");s(this,"image");s(this,"current_frame");s(this,"frame_rate");s(this,"frame_buffer");s(this,"frame_counter");s(this,"loop");s(this,"anim_complete");s(this,"dir_state");this.position=i,this.width=t,this.height=o,this.image_src=n,this.image=new Image,this.image.src=n,this.current_frame=0,this.frame_rate=11,this.frame_buffer=2,this.frame_counter=0,this.loop=!0,this.anim_complete=!1,this.dir_state="right"}update(i,t){this.position.x=i,this.position.y=t,this.frame_counter++,this.dir_state=="right"?this.current_frame>=this.frame_rate-1?this.loop?this.current_frame=0:this.anim_complete=!0:this.frame_counter%this.frame_buffer==0&&this.current_frame++:this.current_frame<=0?this.loop?this.current_frame=this.frame_rate-1:this.anim_complete=!0:this.frame_counter%this.frame_buffer==0&&this.current_frame--}draw(i){const o={position:{x:this.current_frame*this.width+0,y:0},width:this.width,height:this.height};i.drawImage(this.image,o.position.x,o.position.y,o.width,o.height,this.position.x,this.position.y,this.width,this.height)}}class A{constructor(i){s(this,"player");s(this,"up");s(this,"down");s(this,"left");s(this,"right");this.player=i,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.init()}init(){document.addEventListener("keydown",i=>{switch(i.key){case"w":this.player.jumps<h.MAX_JUMPS&&(this.player.velocity.y=-h.JUMP_HEIGHT,this.player.jumps++);break;case"a":this.left=!0;break;case"d":this.right=!0;break;case"j":this.player.attack();break}}),document.addEventListener("keyup",i=>{switch(i.key){case"a":this.left=!1;break;case"d":this.right=!1;break}})}}class S{constructor(i){s(this,"player");s(this,"position");s(this,"width");s(this,"height");s(this,"scale");s(this,"view_horizon");this.player=i,this.position=i.position,this.scale=2,this.width=h.GAME_WIDTH/this.scale,this.height=h.GAME_HEIGHT/this.scale,this.view_horizon=200}update(){if(this.player.position.x+this.player.width+this.view_horizon>this.position.x+this.width){let i=this.player.position.x+this.player.width+this.view_horizon-(this.position.x+this.width);this.position.x+=i}if(this.player.position.x<this.position.x+this.view_horizon){let i=this.player.position.x-(this.position.x+this.view_horizon);this.position.x+=i}this.position.y=this.player.position.y-.5*this.player.height-.5*this.height}}class R{constructor({position:i={x:0,y:0},state:t="idle_right",boxes:o=[]}={}){s(this,"position");s(this,"width");s(this,"height");s(this,"velocity");s(this,"speed");s(this,"attacking");s(this,"jumping");s(this,"falling");s(this,"jumps");s(this,"sprite");s(this,"hitbox");s(this,"collision_blocks");s(this,"boxes");s(this,"animations");s(this,"state");s(this,"controller");s(this,"current_animation");s(this,"camera");s(this,"hit_radius_scale");s(this,"hit_radius");this.position=i,this.width=78,this.height=58,this.velocity={x:0,y:0},this.speed=4,this.attacking=!1,this.jumping=!1,this.falling=!1,this.jumps=0,this.sprite=new b({position:{x:this.position.x,y:this.position.y},width:this.width,height:this.height,image_src:"assets/spritesheets/player/IdleRight.png"}),this.hitbox={position:{x:this.position.x,y:this.position.y},width:this.width,height:this.height},this.hit_radius_scale=2,this.hit_radius={position:{x:this.position.x+.5*this.width,y:this.position.y+.5*this.height},width:this.width*this.hit_radius_scale,height:this.height},this.collision_blocks=[],this.boxes=o,this.animations=u,this.init_animations(),this.state=t,this.controller=new A(this),this.camera=new S(this)}init_animations(){for(let i in this.animations){const t=new Image;t.src=this.animations[i].image_src,this.animations[i].image=t}}switch_state(i){this.sprite.image!=this.animations[i].image&&(this.state=i,i.includes("right")?this.sprite.current_frame=0:this.sprite.current_frame=this.animations[i].frame_rate-1,this.sprite.image=this.animations[i].image,this.sprite.frame_rate=this.animations[i].frame_rate,this.sprite.frame_buffer=this.animations[i].frame_buffer,this.sprite.loop=this.animations[i].loop,this.current_animation=this.animations[i],i.includes("left")?this.sprite.dir_state="left":this.sprite.dir_state="right")}handle_gravity(){this.position.y+=this.velocity.y,this.position.y<h.GAME_HEIGHT-this.height?this.velocity.y+=h.GRAVITY:(this.velocity.y=0,this.position.y=h.GAME_HEIGHT-this.height,this.jumps=0,this.jumping=!1)}handle_movement(){this.position.x+=this.velocity.x,this.update_hitbox(),this.handle_horizontal_collision(),this.attacking||(this.controller.left?(this.velocity.x=-this.speed,this.switch_state("run_left")):this.controller.right?(this.velocity.x=this.speed,this.switch_state("run_right")):(this.velocity.x=0,!this.jumping&&!this.falling&&!this.attacking&&(this.state.includes("left")?this.switch_state("idle_left"):this.switch_state("idle_right")))),this.handle_gravity(),this.update_hitbox(),this.handle_vertical_collision()}handle_horizontal_collision(){for(let i=0;i<this.collision_blocks.length;i++){const t=this.collision_blocks[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.x<0){const o=this.hitbox.position.x-this.position.x;this.position.x=t.position.x+t.width-o+.01;break}if(this.velocity.x>0){const o=this.hitbox.position.x-this.position.x+this.hitbox.width;this.position.x=t.position.x-o-.01;break}}}for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.x<0){const o=this.hitbox.position.x-this.position.x;this.position.x=t.position.x+t.width-o+.01;break}if(this.velocity.x>0){const o=this.hitbox.position.x-this.position.x+this.hitbox.width;this.position.x=t.position.x-o-.01;break}}}}handle_vertical_collision(){for(let i=0;i<this.collision_blocks.length;i++){const t=this.collision_blocks[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.y<0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y;this.position.y=t.position.y+t.height-o+.01,this.jumping=!1;break}if(this.velocity.y>0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y+this.hitbox.height;this.jumps=0,this.position.y=t.position.y-o-.01,this.jumping=!1,this.falling=!1;break}}}for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.y<0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y;this.position.y=t.position.y+t.height-o+.01,this.jumping=!1;break}if(this.velocity.y>0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y+this.hitbox.height;this.jumps=0,this.position.y=t.position.y-o-.01,this.jumping=!1,this.falling=!1;break}}}}handle_object_interaction(){for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];this.attacking&&this.hit_radius.position.x<=t.position.x+t.width&&this.hit_radius.position.x+this.hit_radius.width>=t.position.x&&this.hit_radius.position.y+this.hit_radius.height>=t.position.y&&this.hit_radius.position.y<=t.position.y+t.height&&(t.hp-=1,t.hp<=0&&(t.marked_for_deletion=!0))}this.boxes=this.boxes.filter(i=>!i.marked_for_deletion)}attack(){!this.attacking&&!this.jumping&&(this.attacking=!0)}update_hitbox(){this.hitbox={position:{x:this.position.x+15,y:this.position.y+15},width:30,height:30}}update_hit_radius(){this.hit_radius={position:{x:this.position.x-7.5,y:this.position.y},width:this.width,height:this.height}}update(){this.handle_movement(),this.state.includes("left")?this.sprite.update(this.position.x-15,this.position.y):this.sprite.update(this.position.x,this.position.y),this.velocity.y<0&&(this.jumping=!0,this.state.includes("left")?this.switch_state("jump_left"):this.switch_state("jump_right")),this.velocity.y>1&&(this.falling=!0,this.state.includes("left")?this.switch_state("fall_left"):this.switch_state("fall_right")),this.attacking&&(this.state.includes("left")?this.switch_state("attack_left"):this.switch_state("attack_right"),this.sprite.anim_complete&&(this.attacking=!1,this.sprite.anim_complete=!1)),this.update_hit_radius(),this.handle_object_interaction()}draw_hitbox(i,{fill:t="rgba(255, 0, 0, 0.5)"}={}){i.fillStyle=t,i.fillRect(this.hitbox.position.x,this.hitbox.position.y,this.hitbox.width,this.hitbox.height)}draw_hit_radius(i){i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(this.hit_radius.position.x,this.hit_radius.position.y,this.hit_radius.width,this.hit_radius.height)}draw(i,{fill:t="transparent",outline:o="transparent"}){i.fillStyle=t,i.strokeStyle=o,i.fillRect(this.position.x,this.position.y,this.width,this.height),i.strokeRect(this.position.x,this.position.y,this.width,this.height),this.sprite.draw(i)}render(i,{fill:t="transparent",outline:o="transparent"}={}){this.update(),this.draw(i,{fill:t,outline:o}),this.camera.update()}}class T{constructor({position:i={x:0,y:0},state:t="idle_right",boxes:o=[]}={}){s(this,"position");s(this,"width");s(this,"height");s(this,"velocity");s(this,"speed");s(this,"attacking");s(this,"jumping");s(this,"falling");s(this,"jumps");s(this,"sprite");s(this,"hitbox");s(this,"collision_blocks");s(this,"boxes");s(this,"animations");s(this,"state");s(this,"current_animation");s(this,"hit_radius_scale");s(this,"hit_radius");this.position=i,this.width=34,this.height=28,this.velocity={x:0,y:0},this.speed=4,this.attacking=!1,this.jumping=!1,this.falling=!1,this.jumps=0,this.sprite=new b({position:{x:this.position.x,y:this.position.y},width:this.width,height:this.height,image_src:"assets/spritesheets/pig/IdleLeft.png"}),this.hitbox={position:{x:this.position.x,y:this.position.y},width:this.width,height:this.height},this.hit_radius_scale=2,this.hit_radius={position:{x:this.position.x+.5*this.width,y:this.position.y+.5*this.height},width:this.width*this.hit_radius_scale,height:this.height},this.collision_blocks=[],this.boxes=o,this.animations=u,this.init_animations(),this.state=t}init_animations(){for(let i in this.animations){const t=new Image;t.src=this.animations[i].image_src,this.animations[i].image=t}}switch_state(i){this.sprite.image!=this.animations[i].image&&(this.state=i,i.includes("right")?this.sprite.current_frame=0:this.sprite.current_frame=this.animations[i].frame_rate-1,this.sprite.image=this.animations[i].image,this.sprite.frame_rate=this.animations[i].frame_rate,this.sprite.frame_buffer=this.animations[i].frame_buffer,this.sprite.loop=this.animations[i].loop,this.current_animation=this.animations[i],i.includes("left")?this.sprite.dir_state="left":this.sprite.dir_state="right")}handle_gravity(){this.position.y+=this.velocity.y,this.position.y<h.GAME_HEIGHT-this.height?this.velocity.y+=h.GRAVITY:(this.velocity.y=0,this.position.y=h.GAME_HEIGHT-this.height,this.jumps=0,this.jumping=!1)}handle_horizontal_collision(){for(let i=0;i<this.collision_blocks.length;i++){const t=this.collision_blocks[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.x<0){const o=this.hitbox.position.x-this.position.x;this.position.x=t.position.x+t.width-o+.01;break}if(this.velocity.x>0){const o=this.hitbox.position.x-this.position.x+this.hitbox.width;this.position.x=t.position.x-o-.01;break}}}for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.x<0){const o=this.hitbox.position.x-this.position.x;this.position.x=t.position.x+t.width-o+.01;break}if(this.velocity.x>0){const o=this.hitbox.position.x-this.position.x+this.hitbox.width;this.position.x=t.position.x-o-.01;break}}}}handle_vertical_collision(){for(let i=0;i<this.collision_blocks.length;i++){const t=this.collision_blocks[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.y<0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y;this.position.y=t.position.y+t.height-o+.01,this.jumping=!1;break}if(this.velocity.y>0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y+this.hitbox.height;this.jumps=0,this.position.y=t.position.y-o-.01,this.jumping=!1,this.falling=!1;break}}}for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];if(this.hitbox.position.x<=t.position.x+t.width&&this.hitbox.position.x+this.hitbox.width>=t.position.x&&this.hitbox.position.y+this.hitbox.height>=t.position.y&&this.hitbox.position.y<=t.position.y+t.height){if(this.velocity.y<0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y;this.position.y=t.position.y+t.height-o+.01,this.jumping=!1;break}if(this.velocity.y>0){this.velocity.y=0;const o=this.hitbox.position.y-this.position.y+this.hitbox.height;this.jumps=0,this.position.y=t.position.y-o-.01,this.jumping=!1,this.falling=!1;break}}}}handle_object_interaction(){for(let i=0;i<this.boxes.length;i++){const t=this.boxes[i];this.attacking&&this.hit_radius.position.x<=t.position.x+t.width&&this.hit_radius.position.x+this.hit_radius.width>=t.position.x&&this.hit_radius.position.y+this.hit_radius.height>=t.position.y&&this.hit_radius.position.y<=t.position.y+t.height&&(t.hp-=1,t.hp<=0&&(t.marked_for_deletion=!0))}this.boxes=this.boxes.filter(i=>!i.marked_for_deletion)}attack(){!this.attacking&&!this.jumping&&(this.attacking=!0)}update_hitbox(){this.hitbox={position:{x:this.position.x+15,y:this.position.y+15},width:30,height:30}}update_hit_radius(){this.hit_radius={position:{x:this.position.x-7.5,y:this.position.y},width:this.width,height:this.height}}update(){this.state.includes("left")?this.sprite.update(this.position.x-15,this.position.y):this.sprite.update(this.position.x,this.position.y),this.velocity.y<0&&(this.jumping=!0,this.state.includes("left")?this.switch_state("jump_left"):this.switch_state("jump_right")),this.velocity.y>1&&(this.falling=!0,this.state.includes("left")?this.switch_state("fall_left"):this.switch_state("fall_right")),this.attacking&&(this.state.includes("left")?this.switch_state("attack_left"):this.switch_state("attack_right"),this.sprite.anim_complete&&(this.attacking=!1,this.sprite.anim_complete=!1)),this.update_hit_radius(),this.handle_object_interaction()}draw_hitbox(i,{fill:t="rgba(255, 0, 0, 0.5)"}={}){i.fillStyle=t,i.fillRect(this.hitbox.position.x,this.hitbox.position.y,this.hitbox.width,this.hitbox.height)}draw_hit_radius(i){i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(this.hit_radius.position.x,this.hit_radius.position.y,this.hit_radius.width,this.hit_radius.height)}draw(i,{fill:t="transparent",outline:o="transparent"}){i.fillStyle=t,i.strokeStyle=o,i.fillRect(this.position.x,this.position.y,this.width,this.height),i.strokeRect(this.position.x,this.position.y,this.width,this.height),this.sprite.draw(i),this.draw_hitbox(i)}render(i,{fill:t="transparent",outline:o="transparent"}={}){this.update(),this.draw(i,{fill:t,outline:o})}}class B{constructor({level_number:i=1}={}){s(this,"level_number");s(this,"background");s(this,"collision_blocks_data2D");s(this,"collision_blocks");s(this,"objects");s(this,"effects");s(this,"player");s(this,"backgroundLoaded");s(this,"test_pig");this.level_number=i,this.background=new Image,this.background.src=`assets/backgrounds/BackgroundLevel${i}.png`,this.backgroundLoaded=new Promise((t,o)=>{this.background.onload=()=>t(),this.background.onerror=()=>o(new Error("Failed to load background image"))}),this.collision_blocks_data2D=j(p[i].collision_blocks),this.collision_blocks=[],this.objects=[],this.effects=[],this.player=new R,this.test_pig=new T,this.init()}init(){this.collision_blocks_data2D.length>0&&this.collision_blocks_data2D.forEach((i,t)=>{i.forEach((o,n)=>{o!==0&&this.collision_blocks.push(new G({position:{x:n*h.BLOCK_SIZE,y:t*h.BLOCK_SIZE}}))})}),p[this.level_number].objects_data.forEach(i=>{i.type=="box"&&this.objects.push(new H({position:{x:i.x,y:i.y-i.height}})),i.type=="door"&&this.objects.push(new L({position:{x:i.x,y:i.y-i.height}}))}),this.player.position=p[this.level_number].player_position,this.player.collision_blocks=this.collision_blocks,this.player.boxes=this.objects.filter(i=>i.type==="box"),this.test_pig.position.x=100,this.test_pig.position.y=400,this.test_pig.collision_blocks=this.collision_blocks,this.test_pig.boxes=this.objects.filter(i=>i.type==="box")}async load(i){await this.backgroundLoaded,i.save(),i.scale(this.player.camera.scale,this.player.camera.scale),i.translate(-this.player.camera.position.x,-this.player.camera.position.y),i.drawImage(this.background,0,0,h.GAME_WIDTH,h.GAME_HEIGHT,0,0,h.GAME_WIDTH,h.GAME_HEIGHT),this.objects.forEach(t=>t.render(i)),this.objects.forEach(t=>{t.type=="box"&&t.marked_for_deletion&&this.effects.push(new I({position:t.position,collision_blocks:this.collision_blocks})),t.marked_for_deletion&&(this.objects=this.objects.filter(o=>o!=t))}),this.effects.forEach(t=>t.render(i)),this.effects=this.effects.filter(t=>!t.marked_for_deletion),this.player.render(i),this.test_pig.render(i,{fill:"rgba(255, 255, 255, 0)"}),i.restore()}}class O{constructor({level_number:i=1}={}){s(this,"level_number");s(this,"level");s(this,"started");s(this,"paused");this.level_number=i,this.level=new B({level_number:i}),this.started=!1,this.paused=!1,this.init()}init(){}run(i){document.addEventListener("keydown",o=>{o.key==="Escape"&&(this.paused=!this.paused)});const t=()=>{this.level.load(i),requestAnimationFrame(t)};t()}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("canvas"),i=e.getContext("2d");e.width=h.GAME_WIDTH,e.height=h.GAME_HEIGHT,new O().run(i)});
